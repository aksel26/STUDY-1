# 프레임워크

## 프레임워크?

- 비유하면 카페를 만들떄 직접 하나부터 열까지가 아닌 프렌차이즈를 이용하는 것과 같은 것이다.

[현 top languages]( https://octoverse.github.com/ )

![image-20191111092151609](%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC.assets/image-20191111092151609.png)

- ruby의 경우 인기가 하락하고 있다.
- Django로 하려 한다.
- 한글말로 된 reference도 많다. 또한 reference가 많아 개발에 도움이 된다. 인스타도 Django기반!

## Django

- 웹 서비스는 요청과 응답 두가지로 이루어진다.
- django의 경우 MTV패턴이다. (틀은 MVC랑 똑같다.)
- M(model) , T(Template) , V(View) 데이터를 관리 ,사용자가 보는화면, 중간 관리자(=controller)
- M 이 model,T 가 View ,V가 Controller이다.
- 예를 들어 이용자가 요청이 들어오면 VIew에서 Model에게 요청 Medel은 Database를 서칭하여 View에게 응답하고 View는이를 통해 Template에게 요청을 보내 이용자가 시각화 시켜준다.

## 오늘 할 것 

- 요청 -> urls-> View-> Template -> 사용자가 보는 화면
- urls은 @~ 어노테이션 부분이라고 생각하자.

## 환경 구성

```cmd
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python (master)
$ cd Framword\(Django\)/

#가상환경 구성
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django) (master)
$ virtualenv venv
#가상환경 진입!
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django) (master)
$ source venv/Scripts/activate
#현 pip 현황 파악
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django) (master)
$ pip list
Package    Version
---------- -------
pip        19.3.1
setuptools 41.6.0
wheel      0.33.6
(venv) 
#장고 설치!!!!
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django) (master)
$ pip install django #django =어무해
```

## 장고 특징

- 인스타그램이 장고의 프로젝트, 글쓰는 기능,회원가입기능 이 있는데 장소에서는 이러한 기능을 앱이라 한다. 이러한 앱이 모여 큰 프로젝트를 구성하는 것이 장고다.
- 프로젝트 + 앱으로 구성
- 제일 처음 해야할 것은 프로젝트 생성

## 프로젝트 생성

1. 먼저 파일 하나를 더 생성한다

```cmd
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django) (master)
$ cd django_ex/

```

2. `django-admin startproject [이름] .` 

```cmd
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django_ex (master)
$ django-admin startproject config .
#django-admin startproject [이름] 하면 프로젝트 이름이 [이름]이 되고 그 밑에 설정 파일이 들어있는 파일이름또한 [이름] 이 된다.  [이름] . 을 해주면 설정파일의 이름을 [이름]으로 지정한다는 뜻이며 모든 설정파일을 그 안에 넣겠다는 의미가 된다.
```

## 서버 실행

```cmd
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django_ex (master)
$ python manage.py

student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django_ex (master)
$ python manage.py runserver
#runserver 뒤에 포트번호 입력하면 포트번호가 바뀐다.
```

끄는 것은 ctrl + c

## settings.py

- settings.py는 대부분의 설정이 들어가있고 그 안에 들어있는 secret_key는 베포시 사용하게 된다.
- Debug 는 디버그 처리
- Alllowed-Hosts DNS리바인딩을 방지.................? 베포시에는 해당 도메인을 적어 줘야 한다. * 작성시 누구든 다가올 수 있다.
- Middleware 가 있는데 ............중간을 도와주는 건가 뭐지 이건?
- INSTALLED_APPS는 새로운 앱 추가시 추가해주는 장소이다.
- ROOT-URLCONF 기준이 되는 파일 위치를 나타낸다.
- TEMPLATES 장고에서 탬플릿 파일 설정 ...가능?
- WSGI_APPICATION 설정에 대한 내용
- DATABASES에 대한 내용을 설정할 수 있다. reference가 주석으로 되어있으니 참고하자
- AUTH_PASSWORD_VALIDATIRS 유저의 비밀번호 체크 부분 숫자로만 되어있는지 등등

![image-20191111101315967](%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC.assets/image-20191111101315967.png)

- 장고 설정시 언어와 시간을 설정해주는 것 잊지 말자.

## urls.py

- flask에서 @app.route부분을 따로 모아 관리하는 것!
- 기본으로 admin/이 있다. 서버 실행 후 `localhost:8000/admin`하면 로그인 페이지로 이동 할 수 있다.
- url패턴 관리하는 장소

## wsgi.py

- web server interpace 관리 
- 서버와 장고의 연결을 담당한다.

## manage.py

- 장고의 다양한 실행을 담당 하는 곳으로 변경할 일이 거의 없다.
- 간혹 에러나면서 실행이 안되는 경우가 있다. 이 경우는 주로 python이 64bit가 아닌 32bit일때, 가상환경 실행 안했을때 일어나게 된다. 

## 장고 앱 생성

- 앱 단위는 실제 요청을 처리하는 어플리케이션으로 개발자가 기능 나누는 것의 기준점을 잡게 된다. (따로 주어진 기준점이 없다.)

```cmd
student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django_ex (master)
$ python manage.py startapp pages
#python manage.py startapp [이름]
```

![image-20191111102021096](%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC.assets/image-20191111102021096.png)

- 이렇게 생성 된다.
- admin.py 
  - 해당 테이블에서 데이터 생성, 삭제 가능
  - 커스터마이징 가능
  - 이 덕분에 편하게 데이터 관리 가능하다
- app.py
  - 앱의 정보가 있는 곳으로 거의 수정할 일 없다.
- models.py
  - 장고 패턴 MTV중 M을 담당한다.
  - 데이터베이스에 대한 구조를 접고, 명세를 관리한다.
  - 클래스로 구현을 하게 되며 클래스 명이 테이블 명이다.
  - 설정 변수들이 컬럼이다.
- tests.py
  - 작성된 기능이 제대로 돌아가는지 작성하는 테스트하는 부분
- views.py
  - 가장 많이 수정을 할 views
  - MTV중 V 담당(Controller)
  - flask에서 @app.route밑의 함수를 관리한다 생각하면 된다!
- 앱을 만들었으면 settings.py에 등록을 해주어야 기능 구현이 된다.

![image-20191111102444774](%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC.assets/image-20191111102444774.png)

- 참고로 팁은 settings.py와 urls.py는 위에서부터 추가한다!
- 새로 만들 앱의 urls는 아래서부터 추가한다.

```python
@app.route('/index/<int:num>') = > urls.py
#<int:num>이 고정되어있으면 필요한 수만큼 함수가 필요하기 떄문에 동적으로 받아 오게 된다.
#밑에 부분은 views.py
def index():
    return render_template('index.html')
```

- 장고 앱은 이렇게 두 부분으로 분리하여 기능 관리 한다.



## index(처음 시작)

- urls.py에서 추가

```python
from django.contrib import admin
from django.urls import path
from pages import views #pages추가

urlpatterns = [
    path('admin/', admin.site.urls),
    path('' , views.index), #첫번째는 url패턴 두번째는 정의
    #참고로 장고는 마지막에 /를 붙여줘야한다. 그래서 기본에서는 아무것도 안 붙여도 된다.
]

```



- pages의 views.py

```python
from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.
def index(request):
    return HttpResponse("Hello Django")
#함수 정의
```

### templates

![image-20191111103945187](%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC.assets/image-20191111103945187.png)

- pages 폴더 안에 templates폴더를 생성한다.
- templates안에 `index.html`파일 생성

```html
<h1>Index Page</h1>
<p>Hello Django!</p>
```

- pages폴더 안 views.py

```python
from django.shortcuts import render
from django.http import HttpResponse #Text를 보낼 떄 사용
# Create your views here.
def index(request):
    return render(request, 'index.html')

```



- **이제부터는 urls.py => views.py => index.html 방향으로 만들고 버그 찾기도 이순서로 갈 것이다!**

### 동적 변수

- int : 0 또는 양의 정수와 매치 
- str :  /를 제외한 모든 문자열과 매치 <name> , 디폴트 값
- slug : slug 형식(ASCII, 숫자, 하이픈, 밑줄)과 매치
- uuid : uuid 형식의 문자열과 매치 

 urls.py : path 설정

```python
from django.contrib import admin
from django.urls import path
from pages import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('' , views.index),
    path('<int:age>/', views.age),
]

```

pages의 views.py : 기능 설정

```python
from django.shortcuts import render
from django.http import HttpResponse #Text를 보낼 떄 사용
# Create your views here.
def index(request):
    #return HttpResponse("Hello Django")
    return render(request, 'index.html')

def age(request , age):
    context = {
        'age' : age
        } # 키 : value값
    return render(request, 'age.html' , context)
    #함수 이름은 urls에서 정의한 것과 같아야 하며 딕셔너리 형식으로 보내기 위해 {}로 덮어준다.
```

templates : 보여주는것

age.html

```html
<h1>{{ age }}</h1>

```

### 실습 1

- 숫자를 두개 받아 페이지 n제곱 값을 나타내기)
- (plus,minus,multi, div/ 숫자/숫자 ) 계산하기! 
- 아래는 정답이다

urls.py

```python
from django.contrib import admin
from django.urls import path
from pages import views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('' , views.index),
    path('<int:age>/', views.age),
    path('<int:num>/squ' , views.num),
    path('<str:one>/<int:two>/<int:three>/' , views.count)
]
```

pages , views.py

```python
from django.shortcuts import render
from django.http import HttpResponse #Text를 보낼 떄 사용
# Create your views here.
def index(request):
    #return HttpResponse("Hello Django")
    return render(request, 'index.html')

def age(request , age):
    context = {
        'age' : age
        } # 키 : value값
    return render(request, 'age.html' , context)
    #함수 이름은 urls에서 정의한 것과 같아야 하며 딕셔너리 형식으로 보내기 위해 {}로 덮어준다.
def num(request , num):
    result = num*num # num**2 하면 같다
    re= {'re' : result}

    return render(request , 'num.html' , re)

def count(request , one, two, three):
    if(one == 'plus'):
        result = two + three
    elif(one == 'minus'):
        result = two - three
    elif(one == 'multi'):
        result = two*three
    else:
        result = two/three
    re = {
        're' : result,
        'num1' : two,
        'num2' : three
        }
    return render(request , 'count.html' , re)
```

templates

```html
<!--num.html-->
<h1>{{ re }}</h1>

<!--count.html-->
<h1>{{num1}}와 {{num2}}의 계산결과는 {{ re }}</h1>
```













