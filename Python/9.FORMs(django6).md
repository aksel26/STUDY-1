- extension 중 django를 깔면 쉽게 장고 이용가능
- 그러다 흠은 스니펫이 돌아가지 않는다.

# FORM 

- 우선 셋팅 후 앱 아래 `forms.py`를 만든다.

- ```python
  from django import forms
  from .models import Board
  
  #이름지을때 앱의 이름의 Form이라 지어주자.
  class BoardForm(forms.ModleForm): #일반적으로는 forms.Form이지만 이번엔 modelform을 받자
      class Meta:
          model = Board
          fields = ['title' ,'content'] #요 두개만 만든다. 
  
  ```

- 셋팅이 완료!

  - CRUD를 만들어보자

- urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='boards'
  
  urlpatterns=[
      path("", views.index, name= 'index'),
      path("new/" , views.new , name = 'new'),
  ]
  ```

- view.py

- ```python
  from django.shortcuts import render
  from .forms import BoardForm
  
  # Create your views here.
  def index(request):
      return render(request , "boards/index.html")
  
  def new(reqeust):
      #form.py를 사용할 것이다.
  
      form = BoardForm()  #form 변수에 BoardForm 불러왔다.
      context= {
          'form' : form
      }
  
      return render(reqest, "boards/new.html" , context)
  
  ```

- new.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <form action='' method = 'POST'>
          {{ form }}
      {% csrf_token %}
      <input type= 'submit' value="새글쓰기">
  </form>
  
  {% endblock %}
  ```

- 받은 form값을 불러오기만 하면된다!

- ![image-20191126101020760](9.FORMs(django6).assets/image-20191126101020760.png)

- 안이쁘니까

- new.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <form action='' method = 'POST'>
          {{ form.as_p }}
      {% csrf_token %}
      <input type= 'submit' value="새글쓰기">
  </form>
  
  {% endblock %}
  ```

- ![image-20191126101058230](9.FORMs(django6).assets/image-20191126101058230.png)

- 요롷게 바뀐다. `{{form.as_p}}` 하면 p태크고 감싼다는 뜻으로 아까보다는 조금~이뻐진것을 확인

- 근데 이것도 안 이쁘므로

- ```cmd
  student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django-form (master)
  $ pip install django-crispy-forms
  #를 설치하자.
  ```

- 자세한 것은 [여기를]( https://django-crispy-forms.readthedocs.io/en/latest/ ) 참조~

- 그 후 settings.py에

- ```python
  # Application definition
  
  INSTALLED_APPS = [
      'boards',
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',
      'crispy_forms', #추가해준다!
  ]
  ```

- 

- new.html

- ```html
  {% extends 'base.html' %}
  {% load crispy_forms_tags %} <!--추가!-->
  {% block body %}
  <form action='' method = 'POST'>
      {% csrf_token %}
      {{ form|crispy }} <!-- 추가1-->
      
      <input type= 'submit' value="새글쓰기">
  </form>
  
  {% endblock %}
  ```

- ![image-20191126101802185](9.FORMs(django6).assets/image-20191126101802185.png)

- 요롷게 이뻐졌다.

- ```python
  from django.shortcuts import render , redirect
  from .forms import BoardForm
  from .models import Board
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  
  def new(request):
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save() #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  ```

- index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li>{{board.title}}</li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  
  {% endblock %}
  
  ```

- ![image-20191126103004545](9.FORMs(django6).assets/image-20191126103004545.png)

- 이렇게 나오게 된다.

- 이제 read부분! detail만들자

- 클릭했을때 해당글이 나와야 한다.

- index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a></li> 
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  
  {% endblock %}
  
  ```

- urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='boards'
  
  urlpatterns=[
      path("", views.index, name= 'index'),
      path("new/" , views.new , name = 'new'),
      path('<int:b_id>/' , views.detail , name='detail'),
  ]
  ```

- veiw.py

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  
  def new(request):
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save() #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html')
  ```

- detail.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <table>
      <tr>
          <td>타이틀</td>
          <td>{{board.title}}</td>
      </tr>
      <tr>
          <td>내용</td>
          <td>{{board.content}}</td>
      </tr>
  </table>
  {% endblock %}
  ```

- 수정하기 만들어 보자(detail.html)

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <table>
      <tr>
          <td>타이틀</td>
          <td>{{board.title}}</td>
      </tr>
      <tr>
          <td>내용</td>
          <td>{{board.content}}</td>
      </tr>
  </table>
  
  <a href="{% url 'boards:edit' board.id %}">수정하기</a>
  {% endblock %}
  ```

- urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='boards'
  
  urlpatterns=[
      path("", views.index, name= 'index'),
      path("new/" , views.new , name = 'new'),
      path('<int:b_id>/' , views.detail , name='detail'),
      path('edit/<int:b_id>/', views.edit , name = "edit"),
  ]
  ```

- view.py

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  
  def new(request):
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save() #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html' , context)
  
  def edit(request , b_id):
      board = get_object_or_404(Board, id=b_id)
  
      form = BoardForm(instance=board)#board에 있는 값이 채워져서 넘어갈 수 있다. 
  
      context = {
          'form' : form
      }
  
      return render(request , 'boards/edit.html' , context)
  ```

- edit.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
      {{ form}}
  {% endblock %}
  ```

- 

- ![image-20191126104640882](9.FORMs(django6).assets/image-20191126104640882.png)

- 오홍 잘 나온다.

- edit.html

- ```html
  {% extends 'base.html' %}
  {% load crispy_forms_tags %}
  {% block body %}
  <form action='' method = 'POST'>
      {% csrf_token %}
      {{ form|crispy }}
      <input type= 'submit' value = "수정하기">
  </form>
  
  {% endblock %}
  ```

- ![image-20191126104904849](9.FORMs(django6).assets/image-20191126104904849.png)

- 이쁘게 나왔다

- view.py

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  
  def new(request):
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save() #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html' , context)
  
  def edit(request , b_id):
      board = get_object_or_404(Board, id=b_id)
  
      if request.method =="POST":
          form = BoardForm(request.POST , instance=board) #수정해야 하기 떄문에 instance도 넣어준다.
          if form.is_valid():
              board = form.save()
              return redirect('boards:detail' , board.id) #만약 유효성이 안됐따면 밑에 context로 가게 된다.
      else:
  
          form = BoardForm(instance=board)#board에 있는 값이 채워져서 넘어갈 수 있다. 
  
      #공통 부분
      context = {
          'form' : form
      }
  
      return render(request , 'boards/edit.html' , context)
  ```

- 삭제하기 

- detail.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <table>
      <tr>
          <td>타이틀</td>
          <td>{{board.title}}</td>
      </tr>
      <tr>
          <td>내용</td>
          <td>{{board.content}}</td>
      </tr>
  </table>
  
  <a href="{% url 'boards:edit' board.id %}">수정하기</a>
  <a href="{% url 'boards:delete' board.id %}">삭제하기</a>
  {% endblock %}
  ```

- urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='boards'
  
  urlpatterns=[
      path("", views.index, name= 'index'),
      path("new/" , views.new , name = 'new'),
      path('<int:b_id>/' , views.detail , name='detail'),
      path('edit/<int:b_id>/', views.edit , name = "edit"),
      path('delete/<int:b_id>/' , views.delete , name = 'delete'),
  ]
  ```

- views.py

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  
  def new(request):
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save() #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html' , context)
  
  def edit(request , b_id):
      board = get_object_or_404(Board, id=b_id)
  
      if request.method =="POST":
          form = BoardForm(request.POST , instance=board) #수정해야 하기 떄문에 instance도 넣어준다.
          if form.is_valid():
              board = form.save()
              return redirect('boards:detail' , board.id) #만약 유효성이 안됐따면 밑에 context로 가게 된다.
      else:
  
          form = BoardForm(instance=board)#board에 있는 값이 채워져서 넘어갈 수 있다. 
  
      #공통 부분
      context = {
          'form' : form
      }
  
      return render(request , 'boards/edit.html' , context)
  
  def delete(request , b_id):
      board = get_object_or_404(Board , id=b_id)
      
      if request.method=="POST":
          board.delete()
          return redirext("boards:index")
      return redirect("boards:detail" , board.id) #삭제 버튼 눌러도 POST아니면 그 페이지에 남아있을 것이다.
  
  ```

- ![image-20191126111100297](9.FORMs(django6).assets/image-20191126111100297.png)

- 지금은 a태그라 삭제가 안된다

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <table>
      <tr>
          <td>타이틀</td>
          <td>{{board.title}}</td>
      </tr>
      <tr>
          <td>내용</td>
          <td>{{board.content}}</td>
      </tr>
  </table>
  
  <a href="{% url 'boards:edit' board.id %}">수정하기</a>
  <form action='{% url "boards:delete" board.id %}' method = 'POST'>
      {% csrf_token %}
      <a href="#" onclick="this.parentNode.submit()">삭제하기</a>
      
  </form>
  
  {% endblock %}
  ```

- 삭제 완료!



# 회원가입

- 이미 장고에서 로직을 이미 다 만들어 놨다
- admin으로 들어갈때 로그인 가능했다. 그래서 그대로 가져다 써보자.



- 앱을 하나 새로 만들자

- ```cmd
  student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django-form (master)
  $ python manage.py startapp accounts
  ```

- config / settings.py

- ```python
  
  # Application definition
  
  INSTALLED_APPS = [
      'accounts',
      'boards',
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',
      'crispy_forms',
  ]
  ```

- config / urls.py

- ```python
  from django.contrib import admin
  from django.urls import path, include
  
  urlpatterns = [
      path('accounts/' , include('accounts.urls')),
      path('boards/' , include('boards.urls')),
      path('admin/', admin.site.urls),
      
  ]
  
  ```

- accounts 의 urls.py

- ```python
  from django.urls import path
  
  app_name='accounts'
  urlpatterns=[
      
  ]
  ```

- boards / index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a></li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  <a href="{% url 'accounts:signup' %}">회원가입 </a>
  
  
  {% endblock %}
  
  
  
  ```

- accounts/ urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='accounts'
  urlpatterns=[
      path('signup/' , views.signup, name="signup")   ,
  ]
  ```

- views.py

- ```python
  from django.shortcuts import render
  from django.contrib.auth.forms import UserCreationForm
  
  # Create your views here.
  def signup(request):
      form =UserCreationForm()
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  ```

- signup.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  {{ form }}
  {% endblock %}
  ```

- ![image-20191126112651905](9.FORMs(django6).assets/image-20191126112651905.png)

- 이렇게 나타난다 회원가입 누르면!

- 이쁘게 만들기 위해서

- ```cmd
  student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django-form (master)
  $ pip install django.bootstrap4
  ```

- 사용 방법은 [사이트]( https://django-bootstrap4.readthedocs.io/en/latest/ )를 참고하자

- 여기는 installed app에 넣어야 한다.

- settings.py

- ```python
  
  # Application definition
  
  INSTALLED_APPS = [
      'accounts',
      'boards',
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',
      'crispy_forms',
      'bootstrap4',
  ]
  ```

- accounts/ signup.html

- ```html
  {% extends 'base.html' %}
  {% load bootstrap4 %}
  {% block body %}
  {% bootstrap_form form %}}
  {% endblock %}
  ```

- ![image-20191126113205553](9.FORMs(django6).assets/image-20191126113205553.png)

- 요렇게 나온다.

- 버튼을 만들 수 있는데

- signup.html

- ```html
  {% extends 'base.html' %}
  {% load bootstrap4 %}
  {% block body %}
  <form action='' method = 'POST'>
      {% csrf_token %}
      {% bootstrap_form form %}}
      {% buttons %}
      <!---버튼 사용 방법은 첫번째 -->
          <button type="submit" class="btn btn-primary">회원가입</button>
      {% endbuttons %}
      <!---버튼 사용 방법은 첫번째 -->
      {% buttons  submit="회원가입_2" reset="다시입력" %}
      {% endbuttons %}
  </form>
  
  {% endblock %}
  ```

- ![image-20191126113625455](9.FORMs(django6).assets/image-20191126113625455.png)

- 등록하기~

- accounts / view.py

- ```python
  from django.shortcuts import render
  from django.contrib.auth.forms import UserCreationForm
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          
      form =UserCreationForm()
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  ```

- 설치한다!

- ```cmd
  pip install ipython
  ```

- accounts/view.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          embed()
          if form.is_valid():
              form.save() 
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  ```

- 서버를 실행하고 회원가입 누르면!!!!!!

- ![image-20191126114414107](9.FORMs(django6).assets/image-20191126114414107.png)

- 가 뜬다!

- 다시 view.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          embed()
          if form.is_valid():
              form.save() 
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  ```

- 에서 가입을 하고!

- ![image-20191126114830454](9.FORMs(django6).assets/image-20191126114830454.png)

- form data라고 하면 회원가입한 내용을 확인 할 수 있따!

- 



# 로그인

- boards/index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a></li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  <a href="{% url 'accounts:signup' %}">회원가입 </a>
  <a href="{% url 'accounts:login' %}">로그인</a>
  
  
  {% endblock %}
  
  
  
  
  
  
  
  ```

- accounts.urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='accounts'
  urlpatterns=[
      path('signup/' , views.signup, name="signup")   ,
      path('login/' , views.login, name="login"),
  ]
  ```

- accounts/ views.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          # embed()
          if form.is_valid():
              form.save() 
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  
  def login(request):
      form  = AuthenticationForm()
      context = {
          'form' : form
      }
      return render(request, 'accounts/login.html' , context)
  
  ```

- login.html

- ```html
  
  ```

- accounts.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
  from django.contrib.auth import login as auth_login
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          # embed()
          if form.is_valid():
              form.save() 
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  
  def login(request):
  
      if request.method=="POST":
          form = AuthenticationForm(request, request, POST)
          if form.is_valid():
              auth_login(request, form.get_user())
              return redirect('boards:index')
          else:
              form = AuthenticationForm()
      form  = AuthenticationForm()
  
  
      context = {
          'form' : form
      }
      return render(request, 'accounts/login.html' , context)
  
  ```

- a

- a

- base.html

- ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
  </head>
  <body>
      <div class="container" >
          <h3>안녕하세요, {{ user.username }}</h3>
      </div>
      {% block body %}
      {% endblock %}
          <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    
  </body>
  </html>
  ```

- 

# 로그아웃

- 세션을 지우는게 로그아웃이다.

- boards/ index.py

- ```python
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a></li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  <a href="{% url 'accounts:signup' %}">회원가입 </a>
  <a href="{% url 'accounts:login' %}">로그인</a>
  <a href="{% url 'accounts:logout' %}">로그아웃</a>
  
  
  {% endblock %}
  
  
  
  ```

- accounts/ urls.py

- ```python
  from django.urls import path
  from .import views
  
  app_name='accounts'
  urlpatterns=[
      path('signup/' , views.signup, name="signup")   ,
      path('login/' , views.login, name="login"),
      path('logout/' , views.logout , name="logout"),
  ]
  ```

- accounts/ views.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
  from django.contrib.auth import login as auth_login
  from django.contrib.auth import logout as auth_logout
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          # embed()
          if form.is_valid():
              form.save() 
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  
  def login(request):
  
      if request.method=="POST":
          form = AuthenticationForm(request, request.POST)
          if form.is_valid():
              auth_login(request, form.get_user())
              return redirect('boards:index')
          else:
              form = AuthenticationForm()
      form  = AuthenticationForm()
  
  
      context = {
          'form' : form
      }
      return render(request, 'accounts/login.html' , context)
  
  def logout(request):
      if request.method=="POST": #POST일때만 동작 하겠끔.
  
          auth_logout(request)
  
      return redirect('boards:index')
  
  
  ```

- boards/ index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a></li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  <a href="{% url 'boards:new' %}">New</a>
  {% if user.is_authenticated %}
  
  <form action='{% url "accounts:logout" %}' method = 'POST'>
          {% csrf_token %}
          <a href="#" onclick = "this.parentNode.submit()">로그아웃</a>
  {% else %}
  <a href="{% url 'accounts:signup' %}">회원가입 </a>
  <a href="{% url 'accounts:login' %}">로그인</a>
  {% endif %}
  
      
  </form>
  
  
  {% endblock %}
  
  
  
  
  
  
  
  ```

- base.html

- ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
  </head>
  <body>
      {% if user.is_authenticated %}
      <div class="container" >
          <h3>안녕하세요, {{ user.username }}</h3>
      {% else %}
          <h3>로그인 해주세요</h3>
      
      </div>
      {% endif %}
      {% block body %}
      {% endblock %}
          <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    
  </body>
  </html>
  ```

- 로그인 되었을때만 로그인 이름이 나오게 된다.

- user.is_active: 로그인 허용 여부

- user.is_

- ㅇ

- ㅇ

- ㅇ

- 자동 로그인 가능하게!!!!!

- accounts/ views.p

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
  from django.contrib.auth import login as auth_login
  from django.contrib.auth import logout as auth_logout
  from IPython import embed
  
  # Create your views here.
  def signup(request):
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          # embed()
          if form.is_valid():
              user = form.save() 
              #회원가입하고 이 정보를 유지하기 위해서 추가부분!!!!!!!!!!!!!!!
              auth_login(request, user)
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form
      }
      return render(request , 'accounts/signup.html' , context)
  
  def login(request):
  
      if request.method=="POST":
          form = AuthenticationForm(request, request.POST)
          if form.is_valid():
              auth_login(request, form.get_user())
              return redirect('boards:index')
          else:
              form = AuthenticationForm()
      form  = AuthenticationForm()
  
  
      context = {
          'form' : form
      }
      return render(request, 'accounts/login.html' , context)
  
  def logout(request):
      if request.method=="POST": #POST일때만 동작 하겠끔.
  
          auth_logout(request)
  
      return redirect('boards:index')
  
  
  ```

- 이렇게 되면 회원가입하고 바로 로그인이 된다!





- 로그인을 하고 다른 부분을 막을 수 있도록!!!



### form 합치기

- auth_form.html

- ```html
  {% extends 'base.html' %}
  {% load bootstrap4 %}
  {% block body %}
  <h1>{{label}}</h1>
  
  
  <form action='' method = 'POST'>
      {% csrf_token %}
      {% bootstrap_form form %}
  {% if request.resolver_match.url_name == 'signup' %} <!--이리 쓰면 url이름을 받게 된다. url별로 -->
      {% buttons submit="회원 가입" %}
      {% endbuttons %}
  {% elif request.resolver_match.url_name == 'login' %}
      {% buttons submit="로그인" %}
      {% endbuttons %}
  {% elif request.resolver_match.url_name == 'edit' %}
      {% buttons submit="수정하기" %}
      {% endbuttons %}
  {% else %}
      {% buttons submit="비번 변경" %}
      {% endbuttons %}
  {% endif %}
     
  </form>
  {% if request.resolver_match.url_name == 'edit' %}
  <form action='{% url 'accounts:delete' %}' method = 'POST'>
          {% csrf_token %}
          <a href="#" onclick='this.parentNode.submit()'>회원탈퇴</a>
          
       </form>
  {% endif %}
  
  {% endblock %}
  ```

- views.py

- ```python
  from django.shortcuts import render , redirect
  from django.contrib.auth.forms import UserCreationForm, AuthenticationForm, UserChangeForm , PasswordChangeForm
  from django.contrib.auth import login as auth_login
  from django.contrib.auth import logout as auth_logout
  from IPython import embed
  from .forms import UserCustomChangedForm
  from django.contrib.auth import update_session_auth_hash as update_session
  from django.contrib.auth.decorators import login_required
  # Create your views here.
  def signup(request):
      if request.user.is_authenticated:
          return redirect('boards:index')  #로그인 한사람은 회원가입 다시 못하도록!!!
  
      if request.method=="POST":
          form=UserCreationForm(request.POST) #폼에 해당부분이 채워져있을 것이다.
          # embed()
          if form.is_valid():
              user = form.save() 
              #회원가입하고 이 정보를 유지하기 위해서
              auth_login(request, user)
              return redirect("boards:index")
      else:
          form=UserCreationForm()
          # embed()
  
    
      context= {
          'form' :form,
          'label' : "회원가입"
      }
      return render(request , 'accounts/auth_form.html' , context)
  
  def login(request):
      if request.user.is_authenticated:
          return redirect('boards:index')
      if request.method=="POST":
          form = AuthenticationForm(request, request.POST)
          if form.is_valid():
              auth_login(request, form.get_user())
              return redirect(request.GET.get('next') or 'boards:index') #next로 받을게 있따면....
              #실제 글을 쓰려할떄 로그인이 필요하다면 로그인 페이지 갔따가 다시 NEW로 가는 NEXT가 있기 때문에 바로 이동 가능하게 해준다!
          else:
              form = AuthenticationForm()
      form  = AuthenticationForm()
  
  
      context = {
          'form' : form,
          'label' : '로그인'
      }
      return render(request, 'accounts/auth_form.html' , context)
  
  def logout(request):
      if request.method=="POST": #POST일때만 동작 하겠끔.
  
          auth_logout(request)
  
      return redirect('boards:index')
  
  def edit(request):
      if request.method =="POST":
          form = UserCustomChangedForm(request.POST, instance=request.user) #user정보 넣기 위해 instance를 넣는다.
          if form.is_valid():
              form.save()
              return redirect("boards:index")
      else:
      # 유저 정보 수정 하기
      # form = UserChangeForm()
          form = UserCustomChangedForm() #이렇게 해야 이상한게 안뜬다 즉 이용자에게 적절한것이 뜬다.
  
  
      context= {
          'form' : form,
          'label' : '회원 정보 수정'
      }
      return render(request , 'accounts/auth_form.html' , context)
  
  def chg_pwd(request):
      if request.method=="POST":
          form = PasswordChangeForm(request.user, request.POST) # 패스워드도 폼이 있기 때문에 import하고 불러온다.
          #또한 ()안에 들어가는 인자 위치가 저 순서여야 한다.
          if form.is_valid():
              user = form.save()
              update_session(request.user) #import 해야 쓸 수 있따.
              return redirect('accounts:edit')
      else:
          form = PasswordChangeForm(request.user)
      context = {
          'form' : form,
          'label' : "비번 수정"
      }
      return render(request , 'accounts/auth_form.html' , context)
  @login_required
  def delete(request):
      if request.method=="POST":
          request.user.delete()
  
      return redirect('boards:index')
      
  
  
  ```

- 이렇게 하면 폼을 여러개 만들지 않아도 된다! html하나로 가능!

### 내가 쓴 글은 나만이 수정할 수 있도록

- boards/models.py

- ```python
  from django.db import models
  from django.conf import settings #여기에서 import 받아서
  # Create your models here.
  class Board(models.Model):
      title  = models.CharField(max_length=30)
      content = models.TextField()
      created_at = models.DateTimeField(auto_now_add=True)
      updated_at = models.DateTimeField(auto_now=True)
      user = models.ForeignKey(settings.AUTH_USER_MODEL,on_delete=models.CASCADE)
  
      def __str__(self):
          return self.title
  ```

- 이제 migrations

- ```cmd
  student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django-form (master)
  $ python manage.py makemigrations
  You are trying to add a non-nullable field 'user' to board without a default; we can't do that (the database needs something to populate existing rows).
  Please select a fix:
   1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
   2) Quit, and let me add a default in models.py
  Select an option: 1 #직접 default를 설정하겠다! 란 뜻 2는 자동
  Please enter the default value now, as valid Python
  The datetime and django.utils.timezone modules are available, so you can do e.g. timezone.now
  Type 'exit' to exit this prompt
  >>> 1
  Migrations for 'boards':
    boards\migrations\0002_board_user.py
      - Add field user to board
  (venv) 
  student@M1504 MINGW64 ~/Documents/GitHub/STUDY/Python/Framword(Django)/django-form (master)
  $ python manage.py migrate
  Operations to perform:
    Apply all migrations: admin, auth, boards, contenttypes, sessions
  Running migrations:
    Applying boa # 추가!
    
  ```

- 이후에 유저 정보를 새 글 쓸때 넣어 주어야 하기 때문에

- view.py에서 new부분을 고쳐준다!

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  from django.contrib.auth.decorators import login_required
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  @login_required
  def new(request):
      #로그인 한사람만 글쓰기 가능!
      # if not request.user.is_authenticated:
      #     return redirect('boards:index')
      #또 다른 방법은 데코레이터! from django.contrib.auth.decorators import login_required 선언 후에
  
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save(commit=False) #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              board.user=request.user
              board.save()
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html' , context)
  
  def edit(request , b_id):
      board = get_object_or_404(Board, id=b_id)
  
      if request.method =="POST":
          form = BoardForm(request.POST , instance=board) #수정해야 하기 떄문에 instance도 넣어준다.
          if form.is_valid():
              board = form.save()
              return redirect('boards:detail' , board.id) #만약 유효성이 안됐따면 밑에 context로 가게 된다.
      else:
  
          form = BoardForm(instance=board)#board에 있는 값이 채워져서 넘어갈 수 있다. 
  
      #공통 부분
      context = {
          'form' : form
      }
  
      return render(request , 'boards/edit.html' , context)
  
  def delete(request , b_id):
      board = get_object_or_404(Board , id=b_id)
      
      if request.method=="POST":
          board.delete()
          return redirect("boards:index")
      return redirect("boards:detail" , board.id) #삭제 버튼 눌러도 POST아니면 그 페이지에 남아있을 것이다.
  
  ```

- 이제 새 글을 작성하면 잘 들어가 게 되며~ 이제는 각 글의 유저 정보를 불러와 보자.

- boards/index.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <h1>indexpage</h1>
  <ul>
      {% for board in boards %}
          <li><a href="{% url 'boards:detail' board.id %}">{{board.title}}</a> - {{board.user}}</li>
      {% endfor %}
  </ul>
  
  <!--새글쓰기 링크-->
  
  
  
  
  <form action='{% url "accounts:logout" %}' method = 'POST'>
      {% csrf_token %}
      <a href="{% url 'boards:new' %}">New</a><br>
      
  </form>
  
  {% endblock %}
  
  
  
  
  
  
  
  ```

- ![image-20191126162439076](9.FORMs(django6).assets/image-20191126162439076.png)

- 어떤 유저가 글을 썼는지 확인 가능!

- 이제 유저가 구분이 되고 현재 활동하는 유저는 request에 저장된다. 

- board/detail.html

- ```html
  {% extends 'base.html' %}
  {% block body %}
  <table>
      <tr>
          <td>타이틀</td>
          <td>{{board.title}}</td>
      </tr>
      <tr>
          <td>내용</td>
          <td>{{board.content}}</td>
      </tr>
  </table>
  {% if user == board.user %} <!--user는 현재 페이지를 띄운 user와 글의 유저(board.user)가 같은 사람인가? 란 뜻-->
  <a href="{% url 'boards:edit' board.id %}">수정하기</a>
  <form action='{% url "boards:delete" board.id %}' method = 'POST'>
      {% csrf_token %}
      <a href="#" onclick="this.parentNode.submit()">삭제하기</a>
      
  </form>
  {% endif %}
  {% endblock %}
  ```

- 이리 하면

- 자신이 쓴 글 이외에는 삭제하기, 수정하기  글이 뜨지 않는다!

- 하지만 주소창에 쓰면 넘어가지기 때문에 막아줘야 한다

- boards/views.py

- ```python
  from django.shortcuts import render , redirect , get_object_or_404
  from .forms import BoardForm
  from .models import Board
  from django.contrib.auth.decorators import login_required
  
  # Create your views here.
  def index(request):
      boards = Board.objects.all()
  
      context = {
          'boards' : boards
      }
      return render(request , "boards/index.html" , context)
  @login_required
  def new(request):
      #로그인 한사람만 글쓰기 가능!
      # if not request.user.is_authenticated:
      #     return redirect('boards:index')
      #또 다른 방법은 데코레이터! from django.contrib.auth.decorators import login_required 선언 후에
  
  
      if request.method == "POST":
          form = BoardForm(request.POST) #reqeust.POST로 오는 내용이 BoardForm에 담겨 변수에 저장
          if form.is_valid(): #넘어오는 값이 제대로된 값인지 유효성 검사를 해주는것이 is_vaild()
              board = form.save(commit=False) #로 저장해 주면 된다.알아서 폼에서 Board라는 데이터베이스 안에 저장해준다.
              board.user=request.user
              board.save()
              return redirect ('boards:index')
      else:
              
          #form.py를 사용할 것이다.
          form = BoardForm()  #form 변수에 BoardForm 불러왔다.
  
      #data if, else공통 부분
      context= {
          'form' : form
      }
  
      return render(request, "boards/new.html" , context)
  
  def detail(request , b_id):
      board = get_object_or_404(Board, id=b_id) #get 하면 object 하고 못받으면 에러 띄우기이며 (조건작성) 해준다.
  
      context = {
          'board'  : board
      }
      return render(request, 'boards/detail.html' , context)
  
  def edit(request , b_id):
      board = get_object_or_404(Board, id=b_id)
  
      if request.user == board.user:
          return redirect('boards.index')
  
  
      if request.method =="POST":
          form = BoardForm(request.POST , instance=board) #수정해야 하기 떄문에 instance도 넣어준다.
          if form.is_valid():
              board = form.save()
              return redirect('boards:detail' , board.id) #만약 유효성이 안됐따면 밑에 context로 가게 된다.
      else:
  
          form = BoardForm(instance=board)#board에 있는 값이 채워져서 넘어갈 수 있다. 
  
      #공통 부분
      context = {
          'form' : form
      }
  
          return render(request , 'boards/edit.html' , context)
  
  def delete(request , b_id):
  
      board = get_object_or_404(Board , id=b_id)
  
      if request.user != board.user:
          return redirect('boards:index')
      
      if request.method=="POST":
          board.delete()
          return redirect("boards:index")
      return redirect("boards:detail" , board.id) #삭제 버튼 눌러도 POST아니면 그 페이지에 남아있을 것이다.
  
  ```

- 

